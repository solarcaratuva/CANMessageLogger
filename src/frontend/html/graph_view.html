{% extends "generic.html" %}
{% block title %}Graph View{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="/static/style/graph_view.css">
{% endblock %}

{% block content %}
<!-- Hide error message section from generic template -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Hide the error card from the generic template
    const errorCard = document.getElementById('errorCard');
    if (errorCard) {
      errorCard.style.display = 'none';
    }
  });
</script>

<div class="container-fluid mt-4">
  <div class="row">
    <!-- Graph Container -->
    <div class="col-md-9">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Real-time CAN Data Graph</h4>
        </div>
        
        <!-- Status Bar -->
        <div class="card-body pb-0">
          <div class="status-bar d-flex justify-content-between align-items-center mb-3">
            <div>
              <span id="currentTimestamp" class="status-item badge-primary">Current Time: 0.000s</span>
              <span id="timeRange" class="status-item badge-secondary">Data Range: 0.000s - 0.000s</span>
            </div>
            <div>
              <div class="data-status">
                <span class="data-indicator active" id="liveDataIndicator"></span>
                <span id="dataStatusText">Live Data</span>
              </div>
            </div>
          </div>
          
          <!-- Control Buttons -->
          <div class="control-buttons-container">
            <button id="pauseResumeBtn" class="btn control-button" title="Pause fetching new data">
              <i class="fa fa-pause mr-1" id="pauseResumeIcon"></i> <span id="pauseResumeText">Pause</span>
            </button>
            <button id="zoomBtn" class="btn control-button">
              <i class="fa fa-search-plus mr-1"></i> Zoom
            </button>
            <button id="zoomScrollBtn" class="btn control-button active">
              <i class="fa fa-arrows-alt-h mr-1"></i> Live Scroll
            </button>
            <button id="showAllDataBtn" class="btn control-button">
              <i class="fa fa-chart-line mr-1"></i> Live Show All
            </button>
          </div>
          
          <div id="graphContainer" style="width: 100%; height: 500px;"></div>

          <div class="time-range-selector mt-4 mb-3">
            <!-- Zoom Mode Inputs -->
            <div id="zoomInputs" class="form-row align-items-end">
              <div class="col-md-6">
                <label for="startTime" class="mb-1">Start Time (s):</label>
                <input type="number" class="form-control" id="startTime" step="0.001" min="0" value="0">
              </div>
              <div class="col-md-6">
                <label for="endTime" class="mb-1">End Time (s):</label>
                <input type="number" class="form-control" id="endTime" step="0.001" min="0" value="60">
              </div>
            </div>
            
            <!-- Live Scroll Mode Inputs -->
            <div id="liveScrollInputs" class="form-row align-items-end" style="display: none;">
              <div class="col-md-12">
                <label for="timeDifferential" class="mb-1">Time Window (s):</label>
                <input type="number" class="form-control" id="timeDifferential" step="0.001" min="0.1" value="10">
                <small class="form-text text-muted">Shows the last X seconds from current data time</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Control Panel -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-header bg-secondary text-white">
          <h4 class="mb-0">Data Selection</h4>
        </div>
        <div class="card-body" style="max-height: 600px; overflow-y: auto;">
          <div class="d-flex justify-content-between mb-3">
            <button id="selectAllBtn" class="btn btn-sm btn-outline-primary">Select All</button>
            <button id="clearAllBtn" class="btn btn-sm btn-outline-secondary">Clear All</button>
          </div>
          <div id="signalSelectors">
            <!-- Will be populated dynamically with CAN message types and signals -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Include Plotly.js -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<!-- Include graph_view.js for HTTP polling-based data fetching -->
<script src="/static/js/graph_view.js"></script>
<!-- Include graph_view_init.js for initialization -->
<script src="/static/js/graph_view_init.js"></script>
{% endblock %} 
